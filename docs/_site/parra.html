<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SpinDec2: Parrallelism</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init()
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SpinDec2
   </div>
   <div id="projectbrief">Software Modelling Spinodal Decomposition</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
<div id="nav-tree">
    <div id="nav-tree-contents">
    <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('parra.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Parallelism</div></div>
  <!-- start footer part -->
  <h1 id="fwdeuler_parra">Serial Solver Implementation</h1>
  <h2 id="fwdeulerOpenMP">Loop Parallelisation using OpenMP</h2>
  <p>OpenMP multi-threading is be used for each domain created by MPI to accelerate the grid loops, calculating the bulk chemical potential and total chemical potential.
  The workload of the loops within each solver is shared by a team of parallel threads forked from the master thread. Each thread is allocated a distinct set of iterations which it executes independently. However, only the master thread makes the MPI calls within each MPI domain. </p>
  <h2 id="fwdeulerMPI">Domain Decomposistion using MPI</h2>
  <p>A Cartesian topology is used to split the concentration, total chemical potential, and mobilities grids into subdomains depending on the number of MPI processes requested by the user. To implement periodic boundary conditions (PBCs) "halo" arrays were set up such that boundary values can be efficiently communicated between the different MPI processes. The implementation of the Cartesian topology is illustrated in the figure below for a grid split over 4 MPI processes, where each process executes the relevant calculations on a subdomain. Once the necessary calculations for a subdomain are complete to advance the local concentration grids in time, the global grid can be collected on a single process, and the halos are updated to carry out the next timestep in parallel. 
       </p>

       <p style="text-align:center;"><img src="grid_halo.png" alt="Domain Decomposistion" class="center"> </p>

        <h2 id="fwdeulerMPI">Parallel Performance Metrics</h2>

        <P>The performance of the parallelised code was evaluated using three metrics, namely: the speed up, \(\psi\) (left); parallel efficiency, \(\epsilon\); and Karp-Flatt metric, \(e\). The figure below shows the three performance measures for a 1200x1200 grid test case and the "constant mobilities" problem run for \(1e^{-4}\) timesteps and an output write frequency of 500 frames (inputs provided below).</P>

<p>The results show that the best performance is obtained when the code is run using a combination of MPI and OpenMP, which gives the largest speed up of the parallelisation strategies tested. For MPI/OpenMP, the number of processes is given as:</p>

<center>
  <p>no. of processes = no. of MPI processes \(\times\) no. of OpenMP threads . </p>
</center>

<p>
  For the test case presented the optimal performance is obtained for 4 MPI processes with 4 OpenMP threads for each i.e. 16 processes. Using OpenMP without MPI results in a decrease in performance as the number of OpenMP threads is increased and is therefore not recommended.
</p>

<p>
  For all parallelisation strategies, a decrease in the parallel efficiency with increasing the number of processes is observed, as parallel overheads (e.g. inter-processors communication) become more prominent. This is also reflected in the Karp-Flatt metric, which increases with increasing the number of processes, indicating that the parallel code is limited by such overheads rather than unparallelised work. The Karp-Flatt metric for the OpenMP case exceeds 1.0 (the theoretical upper bound for this metric) due to the resulting increase in the execution time with increasing the number of OpenMP threads.
</p>

<p>To obtain the optimal performance of the code on a given system architecture, such tests are recommended.</p>

<body>
  $$ \psi = \frac{\text{serial code execution time}}{\text{parallel code execution time}} ,$$
</body>

<body>
  $$ \epsilon = \frac{\text{serial code execution time}}{p \times \text{parallel code execution time}} ,$$
</body>

<body>
  $$ e = \frac{\frac{1}{\epsilon} - \frac{1}{p}}{1 - \frac{1}{p}} .$$
</body>

<pre><samp>
concentration_max = 0.9
concentration_min = 0.1
domain_x_size = 1200
domain_y_size = 1200
mobility_a = 4
mobility_b = 4
free_energy_gradient_parameter = 0.0001
bulk_free_energy = 1
checkpoint_interval = 1000
write_frequency = 500
max_time = 1e-6
time_step = 1e-10
random_seed = 12345356
use_input = 0
excitation_a = 0.1
excitation_b = 0.2
temperature_min = 900
temperature_max = 1000
problem = constant
stabilization_term = 0
</samp></pre>

<p style="text-align:center;"><img src="metrics.png" alt="Domain Decomposistion"  width="1450" 
  height="500" class="center"> </p>
       

  <h1 id="spec_parra">Pseudo-Spectral Solver</h1>
  <h2 id="spectralOpenMP">OpenMP</h2>
    <p> The spectral solver is only parallelised with OpenMP, as the fftw library which is used to perform the 
  fast and inverse fast fourier transforms, already handles the parallelisation with MPI.</p> 

</div><!--header-->
<div class="contents">
</div><!-- contents -->
</div><!-- doc-content -->
<p>Authors: Anas Siddiqui, Ben Gosling, Dyaln Morgan, Geraldine Anis, Matyas Parrag</p>
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
